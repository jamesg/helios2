<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Photograph Album - Photograph</title>
        <link rel="stylesheet" href="grid.css">
        <link rel="stylesheet" href="modal.css">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="teletype-theme.css">
    </head>
    <body>
        <div id="modal-container"></div>
        <div class="grid">
            <div class="col-4-4 photograph-container">
                <span class="back-link"><a href="albums.html" id="back-a">Back to album</a></span>
                <div class="photograph" id="photograph-view"></div>
                <ul class="photograph-list photograph-list-small" id="photograph-list"></ul>
            </div>
        </div>
        <script src="jquery.js"></script>
        <script src="underscore.js"></script>
        <script src="backbone.js"></script>
        <script src="views.js"></script>
        <script src="modal.js"></script>
        <script src="application.js"></script>
        <script type="text/javascript">
$(document).ready(
        function() {
            var photograph = new Photograph();
            var albumPhotographs = new PhotographCollection;

            var photographId, albumId;

            var hashChange = function() {
                var params = window.location.hash.substr(1).split('.');
                photographId = params[0];
                albumId = params[1];
                photograph.set('id', photographId);
                photograph.fetch();
                albumPhotographs.url = '/api/album_photograph/' + albumId;
                albumPhotographs.fetch({ reset: true });
            };

            hashChange();
            window.onhashchange = hashChange;

            $('#back-a').attr('href', '/albums.html#' + albumId);
            var photographView = new PhotographView({ el: $('#photograph-view'), model: photograph });

            (new CollectionView({
                view: ThumbnailView,
                el: $('#photograph-list'),
                model: albumPhotographs,
                initializeView: function(view) {
                    view.targetUrl = '/photograph.html#' + view.model.id + '.' + albumId;
                },
                filter: function(model) {
                    var middleIndex = _.findIndex(
                            this.model.models,
                            function(m) { return m.id == photograph.id; }
                            );
                    // Allow two thumbnails either side of this one.
                    return (Math.abs(this.model.indexOf(model) - middleIndex) < 4);
                }
            })).render();
        }
        );

        </script>
    </body>
</html>

